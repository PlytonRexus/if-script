/*! For license information please see 602.f13f1fb485db9e6acdc8.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkif_script=self.webpackChunkif_script||[]).push([[602],{602:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x,Story:()=>a,parseText:()=>y,variableRegex:()=>v});class a{constructor(e,{sections:t,passages:s},{referrable:a,startAt:r,fullTimer:c},{globals:l,stats:i}){this.name=e.trim(),this.sections=t,this.passages=s,this.settings={},this.settings.referrable=a,this.settings.startAt=r,this.settings.fullTimer=c,this.variables={},l&&Object.keys(l).forEach((e=>{this.variables[e]=l[e]})),this.stats=i}findSection(e){let t=this.sections.findIndex((t=>t.serial===e));return-1==t&&(console.warn("No section "+e+" found. Reverting to default section serial 1."),t=0),this.sections[t]}findPassage(e){let t=this.passages.findIndex((t=>t.serial===e));return-1===t&&(console.warn("No passage "+e+" found. Reverting to default passage serial 1."),t=0),this.passages[t]}get type(){return"Story"}}class r{constructor(e,t,s,a,{timer:r}){this.title=e.trim(),this.text=t.trim(),this.choices=s,this.serial=a,this.settings={},this.settings.timer=r}get type(){return"Section"}}class c{constructor(e,t,s,a,r,c){this.mode=r,this.text=s.trim(),this.owner=e,this.target=t,this.variables=a,this.choiceI}get type(){return"Choice"}}const l=/ss>[a-zA-Z0-9"'-_:;\/\s!\*#\$\{\}]+?<ss/g,i=/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm,n=/pp>[a-zA-Z0-9"'-_:,\/\s!\*#;]+?<pp/g,p=/tt>[A-Za-z0-9 '\$\{\}]+?<tt/g,h=/>>[a-zA-Z0-9"'-_:;\/\s!\*#\.\[\]\$\{\}]+?<</g,o=/ch>[a-zA-Z0-9"'-_:;\/\s!\*#\.\[\]\$\{\}]+?<ch/g,g=/\[\[[0-9]+\]\]/g,m=/settings>[a-zA-Z0-9"'-_:;\/\s!\*#\.\$\{\}]+?<settings/,u=/@referrable (true)|(false)/,f=/@startAt [0-9]+/,b=/@fullTimer [0-9]+ \[\[\d+\]\]/,d=/secset>[a-zA-Z0-9"'-_:;\/\s!\*#\.]+?<secset/,A=/\$\{[a-zA-Z0-9=]+?\}/g,_=/__input/,w=/@timer [0-9]+ \[\[\d+\]\]/,I=/\$\{[a-zA-Z0-9]+?=[a-zA-Z0-9_ ]+?\}/g,$=/[a-zA-Z0-9_ ]+/,z=/\$\{__[a-zA-Z0-9_=]+?\}/g,Z=/<\s*\w+[^>]*>(.*?)(<\s*\/\s*\w+>)|/g,v=A;function y(e){let t=(e=e.replace(i,"").replace(/>>/g,"").replace(/<</g,"")).match(m);t=t?t[0]:"";const{referrable:s,startAt:A,fullTimer:v,globals:y}=function(e){let t=(e=e.replace(/settings>/,"").replace(/<settings/,"")).match(u);t=t?t[0].replace(/@referrable /,""):"",t="true"===t;let s=(e=e.replace(u,"").replace(/@referrable/,"")).match(f);s=s?s[0].replace(/@startAt /,""):"",s=parseInt(s)?parseInt(s):1;let a=(e=e.replace(f,"")).match(b);a=a?a[0].replace(/@fullTimer /,""):"0";const r=a.match(/\d+/g),c={};r.length>1?(c.timer=parseInt(r[0])?parseInt(r[0]):0,c.target=parseInt(r[1])?parseInt(r[1]):1):(c.timer=0,c.target=1);return{referrable:t,startAt:s,fullTimer:c,globals:function(e){const t=e.match(I)||[],s={};return t.forEach((e=>{let t=(e=e.replace(/\$\{/,"").replace(/\}/,"").trim()).match(/[A-Za-z0-9]+/)||[];if(!(t.length>0))return console.warn("Invalid variable ${}!"),{};t=t[0];let a=(e=e.replace(/\w+=/,"")).match($)||[];a=a.length>0?a[0]:"",""===a&&console.warn("Variable value was read as ''. Are you sure the value should be empty?"),s[t]=a})),s}(e=e.replace(b,""))}}(t);e=e.replace(m,"");let x=0;const T=(e.match(l)||[]).map((e=>(x+=1,function(e,t){let s=(e=e.replace(/ss>/gi,"").replace(/<ss/gi,"")).match(d)||[];s=s.length>0?s[0]:"";const{timer:a}=function(e,t){let s=e.match(w);s=s?s[0].replace(/@timer /,""):"0";const a=s.match(/\d+/g),r={};return a.length>1?(r.timer=parseInt(a[0])?parseInt(a[0]):0,r.target=parseInt(a[1])?parseInt(a[1]):t+1):(r.timer=0,r.target=1),e=e.replace(w,""),{timer:r}}(s,t);let l=e.match(p)?e.match(p)[0]:"";l=l.replace(/tt>/,"").replace(/<tt/,""),e=e.replace(p,"");let i="";(e.match(h)||[]).forEach((e=>{e=e.replace(/>>/,"").replace(/<</,""),i+=e=`<p>${e}</p>`}));let n=0;const m=(e.match(o)||[]).map((e=>(n+=1,function(e,t,s){let a=(e=e.replace(/ch>/,"").replace(/<ch/,"")).match(g);a=a?a[0]:"",a=a.replace(/\[\[/,"").replace(/\]\]/,""),a=parseInt(a,10);let r="basic";(e=(e=e.replace(g,"")).replace(Z,"")).match(_)&&(e=e.replace(_,`<input type="text" class="if_r-choice-input" id="if_r-choice-input-${s}"/>`),r="input");const l=(e.match(z)||[]).map((e=>e.replace(/\$\{/,"").replace(/\}/,"").replace(/\s/g,"").replace("__","")));return e=e.replace(z,""),new c(t,a,e,l,r,s)}(e,t,n))));return new r(l,i,m,t,{timer:a})}(e,x)))),S=((e=e.replace(l,"")).match(n)||[]).map((e=>parsePassage(e)));return new a(Date.now().toString(),{sections:T,passages:S},{referrable:s,startAt:A,fullTimer:v},{globals:y})}const x={Story:a,parseText:y,variableRegex:A}}}]);