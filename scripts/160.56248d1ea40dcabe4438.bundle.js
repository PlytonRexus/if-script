/*! For license information please see 160.56248d1ea40dcabe4438.bundle.js.LICENSE.txt */
(self.webpackChunkif_script=self.webpackChunkif_script||[]).push([[160],{421:(t,e,s)=>{var i={"./bricks.css":[961,893,961],"./choicescript-sepia.css":[95,95],"./cyan.css":[80,80],"./default.css":[378,378]};function n(t){if(!s.o(i,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=i[t],n=e[0];return Promise.all(e.slice(1).map(s.e)).then((()=>s(n)))}n.keys=()=>Object.keys(i),n.id=421,t.exports=n},103:(t,e,s)=>{"use strict";s.d(e,{Z:()=>i});const i={targetId:"#if_r-output-area",alertAreaId:"#if_r-alerts-area",sectionDisplayId:"#if_r-section-display-area",burgerId:"#if_r-burger",statsDivId:"#if_r-stats-div",statsDivClass:".if_r-stats-div",undoButtonId:"#if_r-undo-button",resetButtonId:"#if_r-reset-button",saveGameId:"#if_r-save-game-button",uploadSaveFileId:"#if_r-save-file-selector"}},291:(t,e,s)=>{"use strict";s.d(e,{Z:()=>i});const i={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+":10,"-":10,"*":20,"/":20,"%":20}},139:(t,e,s)=>{"use strict";s.d(e,{Z:()=>i});const i={ASSIGNMENT:"=",LOGICAL_OR:"||",LOGICAL_AND:"&&",LESS:"<",GREATER:">",LEQUAL:"<=",GEQUAL:">=",EQUAL:"==",NOT_EQUAL:"!=",ADDITION:"+",SUBTRACTION:"-",MULTIPLICATION:"*",DIVISION:"/",MODULO:"%"}},665:(t,e,s)=>{"use strict";s.d(e,{Z:()=>i});const i={SECTION_START:"SECTION_START",SECTION_END:"SECTION_END",CHOICE_START:"CHOICE_START",CHOICE_END:"CHOICE_END",PROPERTY_KW:"PROPERTY_KW",CONDITIONAL_KW:"CONDITIONAL_KW",OTHER_KW:"OTHER_KW",STRING:"STRING",VARIABLE:"VARIABLE",OPERATOR:"OPERATOR",PUNCTUATION:"PUNCTUATION",NUMBER:"NUMBER",NEWLINE_CHAR:"NEWLINE_CHAR",BOOLEAN:"BOOLEAN"}},513:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});class i extends Error{constructor(){super(),this.type="IFError"}}const n=i},2:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(513);class n extends i.Z{constructor(t){super(),this.message=t,this.type="Interpreter exception"}log(){console.log(this.type+": "+this.message)}}const o=n},721:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(513);class n extends i.Z{constructor(t="",e,s,i){super(),this.message=t,this.line=this.message,this.col=s,i&&this.log()}log(){console.log((this.line,this.col?"at: "+this.line+":"+this.col:""))}}const o=n},160:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _Run_mjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(633),_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(103),_models_Story_mjs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(207),_exceptions_InterpreterException_mjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2),_models_Choice_mjs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(858),_models_Section_mjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(167),_models_Token_mjs__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(608),_constants_custom_tokenTypes_mjs__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(665),_models_ConditionalBlock_mjs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(72),_models_Action_mjs__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(546),_InterpreterUtils_mjs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(446);class Interpreter{constructor(t){this.debug="undefined"!=typeof process&&process?process.env.IF_DEBUG:!!localStorage.getItem("IF_DEBUG"),this.run=t||null,this.utils=new _InterpreterUtils_mjs__WEBPACK_IMPORTED_MODULE_9__.Z,this.run&&__webpack_require__(421)("./"+this.run.theme+".css")}loadStory(t,e,s){if(!t&&!e||t&&!(t instanceof _models_Story_mjs__WEBPACK_IMPORTED_MODULE_2__.Z))throw new _exceptions_InterpreterException_mjs__WEBPACK_IMPORTED_MODULE_3__.Z("Invalid story supplied");if(this.run=e||new _Run_mjs__WEBPACK_IMPORTED_MODULE_0__.Z(t,null,s),this.run&&__webpack_require__(421)("./"+this.run.theme+".css"),console.info("Story loading..."),this.generateDisplay(),e||this.resetVariables(),this.run.story.settings.fullTimer){const{timer:t,target:e}=this.run.story.settings.fullTimer;0!==t&&this.setTimer(t,e)}this.run.state.section||this.setState({section:this.run.story.settings.startAt,turn:0}),this.run.state.variables.turn=0,this.loadSection(null,this.run.state.section),this.showStats(),document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId).style.display="none",document.querySelector("#if_r-story-title-wrap").innerHTML=this.run.story.name,this.debug||console.clear(),console.info("Load finished. Happy playing!")}generateDisplay(){console.info("Generating dislay...");let t=document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.targetId);if(!t){const e=document.createElement("div");e.setAttribute("id",this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.targetId)),document.querySelector("body").appendChild(e),t=document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.targetId)}t.innerHTML=`\n      <div id="if_r-story-title-wrap"></div>\n      <div id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivId)}" class="${this.replaceDot(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivClass)}">\n          <a href="javascript:void(0)" class="closebtn">&times;</a>\n          <a href="#" id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.resetButtonId)}">Restart</a>\n          <a href="#" id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId)}">Undo</a>\n          <a href="#" id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.saveGameId)}" download="${this.run.story.name} - ${new Date}.ifsave">Save game</a>\n          \x3c!-- <a href="#" id="">Stats</a> --\x3e\n          <div>\n            <a href="#">Music</a>\n            <audio controls id="if_r-audio-player">\n              <source src="" type="audio/mp3" id="if_r-audio-source">\n              Your browser does not support audio.\n            </audio>\n          </div>\n          <div>\n            <a href="#">Upload save file</a>\n            <input type="file" id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.uploadSaveFileId)}" accept=".ifsave, .json" />\n          </div>\n      </div>\n      <div id="if_r-status-bar">\n      <div id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.alertAreaId)}">\n      </div>\n      <div id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.burgerId)}">\n      <a href="#" id="if_r-burger-icon">&#9776;</a>\n      </div>\n      </div>\n      <div id="${this.replaceHash(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.sectionDisplayId)}">\n      </div>`,document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.burgerId).addEventListener("click",(t=>{t.preventDefault(),this.showStatsDiv()})),console.info("Display loaded.")}resetVariables(){this.run.state.variables={},Object.keys(this.run.story.persistent).forEach((t=>this.run.state.variables[t]=this.run.story.persistent[t]))}generateSectionBySerial(t){let e;return e=t instanceof _models_Section_mjs__WEBPACK_IMPORTED_MODULE_5__.Z?t:this.run.story.findSection(t),this.generateHTMLForSection(e)}generateHTMLForSection(t){let e="";if(!(t&&t instanceof _models_Section_mjs__WEBPACK_IMPORTED_MODULE_5__.Z))return void this.showAlert("Something's wrong!");let{title:s,choices:i,text:n,serial:o}=t,r=this.resolveSyntaxTree(s,"",t);r=this.utils.formatText(r);let _=this.resolveSyntaxTree(n,"",t);_=this.utils.formatText(_);let a={};return i=i.filter((t=>!a[t.choiceI]&&(a[t.choiceI]=!0,!0))),e+=`<div class="if_r-section" id="section-${o}">`,e+=`<span class="if_r-section-title">${r}</span>`,e+=`<div class="if_r-paras">${_}</div>`,e+=`<div class="if_r-section-choices-list" id="section-${o}-choices">`,e=this.loadChoices(i,e,o),e+="</div>",e.replaceAll("<p></p>","")}resolveConditionalBlock(t,e){let s="";return t instanceof _models_ConditionalBlock_mjs__WEBPACK_IMPORTED_MODULE_7__.Z&&(this.resolveAction(t.cond,!1,e)?s=this.resolveAction(t.then,!1,e):t.else&&(s=this.resolveAction(t.else,!1,e))),s??""}resolveSyntaxTree(t,e="",s){return"string"==typeof t?t:t.reduce(((t,i,n)=>{if("string"==typeof e)if(i instanceof _models_Token_mjs__WEBPACK_IMPORTED_MODULE_10__.Z){const{VARIABLE:e,STRING:s,NUMBER:n}=_constants_custom_tokenTypes_mjs__WEBPACK_IMPORTED_MODULE_6__.Z;i.type===e?t+=this.run.state.variables[i.symbol]:(i.type===s||i.type,t+=i.symbol)}else i instanceof _models_ConditionalBlock_mjs__WEBPACK_IMPORTED_MODULE_7__.Z?t+=this.resolveConditionalBlock(i,s):i instanceof _models_Action_mjs__WEBPACK_IMPORTED_MODULE_8__.Z&&(t+=this.resolveAction(i,!1,s));return i instanceof _models_Choice_mjs__WEBPACK_IMPORTED_MODULE_4__.Z&&s.choices.push(i),t}),e)}resolveAction(t,e=!1,s){if(!(t instanceof _models_Action_mjs__WEBPACK_IMPORTED_MODULE_8__.Z))return!e&&t instanceof _models_Token_mjs__WEBPACK_IMPORTED_MODULE_10__.Z&&t.type===_constants_custom_tokenTypes_mjs__WEBPACK_IMPORTED_MODULE_6__.Z.VARIABLE?this.run.state.variables[t.symbol]:t instanceof _models_Choice_mjs__WEBPACK_IMPORTED_MODULE_4__.Z?(s.choices.push(t),null):t.symbol;if("assign"===t.type)return this.run.state.variables[this.resolveAction(t.left,!0,s)]=this.resolveAction(t.right,!1,s),"";if("binary"===t.type){const e=this.resolveAction(t.left,!1,s),i=this.resolveAction(t.right,!1,s);return this.utils.solveAction(t,e,i)}}loadChoices(t,e,s){return(t=[...new Set(t)]).forEach(((t,i)=>{const{target:n,owner:o,mode:r}=t,_=this.utils.formatText(this.resolveSyntaxTree(t.text,"")).trim().replace(/^<p>/,"").replace(/<\/p>$/,"");i++,"input"===t.mode?e+=this.getChoiceWrapper(n,o,s,i,r,`${_} <input type="text" class="if_r-choice-input" id="if_r-choice-input-${i}" />`):e+=this.getChoiceWrapper(n,o,s,i,r,_)})),e}getChoiceWrapper(t,e,s,i,n,o){return`<div class="if_r-section-choice-li"> <div class="if_r-section-choice" data-if_r-target="${t}"\ndata-if_r-owner="${e}" id="if_r-${s}-choice-${i}"\ndata-if_r-mode="${n}" data-if_r-i="${i}">${o}</div></div>`}isSatisfied(t){if(!t)return!0;const{comparisons:e,glue:s,type:i}=t;return s?"&"===s.trim()?(e.forEach((t=>{if(!this.doesMatch(t))return!1})),!0):"|"===s.trim()?(e.forEach((t=>{if(this.doesMatch(t))return!0})),!1):void 0:this.doesMatch(e[0])}doesMatch(comp,type){let truth;if(type&&"vs"===type){const real=this.run.state.variables[comp.variable],given=parseInt(comp.against)?parseInt(comp.against):comp.against.trim();truth=eval(`(parseInt('${real}') ? parseInt('${real}') : '${real}') ${comp.operator.trim()} (parseInt('${given}') ? parseInt('${given}') : '${given}') ? true : false`)}else{const real=this.run.state.variables[comp.variable],given=parseInt(comp.against)?parseInt(comp.against):this.run.state.variables[comp.against.trim()];truth=eval(`(parseInt('${real}') ? parseInt('${real}') : '${real}') ${comp.operator.trim()} (parseInt('${given}') ? parseInt('${given}') : '${given}') ? true : false`)}return truth}replaceVars(t,e){return Object.keys(e).forEach((s=>t=this.replaceOneVariable(t,s,e[s]))),t}replaceOneVariable(t,e,s){const i=Date.now();if("string"==typeof t){let n=0;for(;n>=0&&Date.now()-i<1e4;)if(n=t.indexOf("${"+e+"}",n>0?n+1:0),!(-1===n||n>0&&"\\"===t[n-1])){const i=t.substring(0,n),o=t.substring(n+e.length+3);t=i+s+o}return t}}setupUndo(){this.setState({lastSection:this.run.state.section})}recordOldValues(t){this.run.state.oldValues={},t.forEach((t=>{this.run.state.oldValues[t]=this.run.state.variables[t]}))}undoVars(t){Object.keys(t).forEach((e=>{this.run.state.variables[e]=t[e]}))}undoTurn(){this.undoVars(this.run.state.oldValues),this.changeTurn(-1),this.switchSection(this.run.state.lastSection.serial,!0),document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId).style.display="none"}switchSection(t,e){const s=this.generateSectionBySerial(t);this.loadSection(s),e||(this.setupUndo(),document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId).style.display="block");const i=this.run.story.findSection(t),{timer:n,target:o}=i.settings.timer;this.run.state.currentTimeout&&clearTimeout(this.run.state.currentTimeout),n&&o&&this.setTimer(n,o),e||this.changeTurn(),this.setState({section:t}),this.showStats()}setState(t){Object.keys(t).forEach((e=>{"section"!==e?this.run.state[e]=t[e]:"section"===e&&(this.run.state.section=this.run.story.findSection(t.section))}))}changeTurn(t,e){this.setState({turn:e||(t?this.run.state.turn+t:this.run.state.turn+1)}),this.run.state.variables.turn=e||(t?this.run.state.turn+t:this.run.state.turn+1)}showStats(){const t=Object.keys(this.run.state.variables);let e=`<pre> <b>Turn:</b> ${this.run.state.turn}   `;t.forEach((t=>{"turn"!==t&&(e+=`<b>${t}:</b> ${this.run.state.variables[t]}   `)})),e+="</pre>",document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.alertAreaId).innerHTML=e}loadSection(t,e){this.run.story.settings.referrable?this.appendSection(t,e):this.replaceSection(t,e)}changeVariables(t,e){this.recordOldValues(t),t.forEach((t=>{this.run.state.variables[t instanceof _models_Token_mjs__WEBPACK_IMPORTED_MODULE_10__.Z?t.symbol:t]=parseInt(e)?parseInt(e):e}))}doActions(t){t.forEach((t=>{Object.assign(this.run.state.oldValues,this.run.state.variables),this.resolveAction(t)}))}finishAction(t,e,s){"+"===e?this.run.state.variables[t]+=s:"-"===e?this.run.state.variables[t]-=s:"*"===e?this.run.state.variables[t]*=s:"/"===e?this.run.state.variables[t]/=s:"="===e&&(this.run.state.variables[t]=s)}setTimer(t,e){return this.run.state.currentTimeout=setTimeout((()=>{this.switchSection(e)}),1e3*t)}replaceSection(t,e){document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.sectionDisplayId).innerHTML=e?this.generateSectionBySerial(e):t,this.setListenersOnChoices()}appendSection(t,e){e?document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.sectionDisplayId).innerHTML=this.generateSectionBySerial(e):document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.sectionDisplayId).innerHTML+=t,this.setListenersOnChoices()}showAlert(t){document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.alertAreaId).innerHTML=t,setTimeout((()=>{document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.alertAreaId).innerHTML=""}),3e3)}setListenersOnChoices(){document.querySelectorAll(".if_r-section-choice").forEach((t=>{t.onclick=e=>{e.preventDefault();const s=t.getAttribute("data-if_r-i");let{actions:i,targetType:n,mode:o,variables:r,target:_,input:a}=this.run.state.section.findChoice(s);if("scene"===n){const t=this.run.story.findScene(_);!0===this.debug&&console.log("Going to scene "+_),_=t.first,!0===this.debug&&console.log("Starting section "+_),this.doSceneActions(t)}if("input"===o){const e=document.querySelector(`#if_r-choice-input-${s}`).value;""===e||(t.onclick="",this.changeVariables(r,e),this.changeVariables(a,e),i&&this.doActions(i),this.switchSection(_))}else t.onclick="",this.changeVariables(r,t.innerHTML),i&&this.doActions(i),this.switchSection(_)}}))}doSceneActions(t){this.debug&&console.log("Doing relevant scene actions..."),this.run.state.scene=t;const{music:e}=this.run.state.scene;if(e)try{const t=new URL(e);document.querySelector("#if_r-audio-source").src=t.href;const s=document.querySelector("#if_r-audio-player");s.load(),s.play()}catch(t){this.debug&&console.log("Invalid URL.")}}resetStory(){window.confirm("Restart the story? this is a beta feature.")&&this.loadStory(this.run.story,null,this.run.theme)}showStatsDiv(){const t=document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivClass);t.style.display="block",t.style.width="100%",this.sidebarListeners("set")}sidebarListeners(t){"set"===t?(document.querySelector(`${_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivId} .closebtn`).onclick=this.hideStatsDiv,document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId).onclick=this.undoTurn,document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.resetButtonId).onclick=this.resetStory.bind(this),document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.saveGameId).onclick=this.saveGame.bind(this),document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.uploadSaveFileId).onchange=this.uploadSaveFile.bind(this)):"unset"===t&&(document.querySelector(`${_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivClass} .closebtn`).onclick="",document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.undoButtonId).onclick="",document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.resetButtonId).onclick="",document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.saveGameId).onclick="")}uploadSaveFile(t){let e=t.target.files[0];const s=new FileReader;s.addEventListener("load",(t=>{const e=t.target.result,s=JSON.parse(e);this.run=_Run_mjs__WEBPACK_IMPORTED_MODULE_0__.Z.fromJson(s),this.loadStory(this.run.story,this.run,this.run.theme)})),s.readAsText(e)}saveGame(t){if(this.run){let e=JSON.stringify(this.run);console.log(e);const s=new Blob([e],{type:"application/json"});t.target.setAttribute("href",window.URL.createObjectURL(s))}}hideStatsDiv=()=>{const t=document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivClass);t.style.display="none",t.style.width="0",this.sidebarListeners("unset")};replaceHash(t,e){return t.replace("#",e||"")}replaceDot(t,e){return t.replace(".",e||"")}generateHTML(t){const{name:e,sections:s,passages:i}=t;let n="";return n+=`<h2>${e} - New Story</h2>`,document.title=`${e} | IF`,s.forEach((t=>{n+=this.generateHTMLForSection(t)})),n}executeJs(text){return eval(text)}generateStatsHtml(){}setStats(t){document.querySelector(_constants_custom_dom_mjs__WEBPACK_IMPORTED_MODULE_1__.Z.statsDivId).innerHTML=t}}const __WEBPACK_DEFAULT_EXPORT__=Interpreter},446:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(139),n=s(132);const o=class{solveAction(t,e,s){let n;switch(t.operator){case i.Z.ADDITION:n=e+s;break;case i.Z.SUBTRACTION:n=e-s;break;case i.Z.MULTIPLICATION:n=e*s;break;case i.Z.DIVISION:n=e/s;break;case i.Z.MODULO:n=e%s;break;case i.Z.EQUAL:n=e===s;break;case i.Z.NOT_EQUAL:n=e!==s;break;case i.Z.GREATER:n=e>s;break;case i.Z.LESS:n=e<s;break;case i.Z.GEQUAL:n=e>=s;break;case i.Z.LEQUAL:n=e<=s;break;case i.Z.LOGICAL_OR:n=e||s;break;case i.Z.LOGICAL_AND:n=e&&s}return n}formatText(t){return n?(new n.Converter).makeHtml(t):t}}},633:(t,e,s)=>{"use strict";s.d(e,{Z:()=>c});var i=s(167),n=s(861);class o{variables={turn:0};section=null;lastSection=null;oldValues={};currentTimeout=0;turn=0;scene=null;constructor(t){t&&("string"==typeof t&&(t=JSON.parse(t)),Object.assign(this,t),this.section=i.Z.fromJson(t.section),t.lastSection&&(this.lastSection=i.Z.fromJson(t.lastSection)),this.scene=n.Z.fromJson(t.scene))}static fromJson(t){return new o(t)}}const r=o;var _=s(207);class a{constructor(t,e=null,s="default",i){i?("string"==typeof i&&(i=JSON.parse(i)),this.story=_.Z.fromJson(i.story),this.state=i.state?r.fromJson(i.state):null,this.variables=i.variables,this.theme=i.theme):(this.story=t,this.state=e||new r,this.variables={},this.theme=s)}findSection(t){return this.story.findSection(t)}findScene(t){return this.story.findScene(t)}static fromJson(t){return new a(null,null,null,t)}}const c=a},546:(t,e,s)=>{"use strict";s.d(e,{Z:()=>r});var i=s(291),n=s(608);class o{_class="Action";constructor(t,e,s,r,_){_?("string"==typeof _&&(_=JSON.parse(_)),Object.assign(this,_),"Action"===this.left._class?this.left=o.fromJson(this.left):"Token"===this.left._class&&(this.left=n.Z.fromJson(this.left)),"Action"===this.right._class?this.right=o.fromJson(this.right):"Token"===this.right._class&&(this.right=n.Z.fromJson(this.right))):(this.type=t,this.operator=e,this.left=s,this.right=r),this.precedence=i.Z[this.operator]}static fromJson(t){return new o(null,null,null,null,t)}}const r=o},858:(t,e,s)=>{"use strict";s.d(e,{Z:()=>_});var i=s(546),n=s(608),o=s(72);class r{_class="Choice";constructor(t,e,s){if(s){"string"==typeof s&&(s=JSON.parse(s));let{owner:t,target:e,text:r,variables:_,mode:a,choiceI:c,condition:l,actions:h,input:u,targetType:d}=s;this.mode=a,this.text=r,this.owner=t,this.target=e,this.variables=_,this.choiceI=c,this.condition=l||null,this.actions=h,this.input="input"===this.mode?u:null,this.targetType=d||"section",this.actions=(this.actions||[]).map(i.Z.fromJson),this.text=(this.text||[]).map((t=>"Token"===t._class?n.Z.fromJson(t):"ConditionalBlock"===t._class?o.Z.fromJson(t):"Action"===t._class?i.Z.fromJson(t):void 0))}else{let{owner:s,target:i,text:n}=t,{variables:o,mode:r,choiceI:_,condition:a,actions:c,input:l,targetType:h}=e;this.mode=r,this.text=n,this.owner=s,this.target=i,this.variables=o,this.choiceI=_,this.condition=a||null,this.actions=c,this.input="input"===this.mode?l:null,this.targetType=h||"section"}}static fromJson(t){return new r({},{},t)}get type(){return this._class}set type(t){this._class=t}}const _=r},72:(t,e,s)=>{"use strict";s.d(e,{Z:()=>_});var i=s(546),n=s(608),o=s(858);class r{_class="ConditionalBlock";constructor(t,e){e&&("string"==typeof e&&(e=JSON.parse(e)),"Action"===(t=e).cond._class&&(t.cond=i.Z.fromJson(t.cond)),t.then&&"Action"===t.then._class?t.then=i.Z.fromJson(t.then):t.then&&"ConditionalBlock"===t.then._class?t.then=r.fromJson(t.then):t.then&&"Token"===t.then._class?t.then=n.Z.fromJson(t.then):t.then&&"Choice"===t.then._class&&(t.then=o.Z.fromJson(t.then)),void 0!==t.else&&t.else&&"Action"===t.else._class?t.else=i.Z.fromJson(t.else):void 0!==t.else&&t.else&&"ConditionalBlock"===t.else._class?t.else=r.fromJson(t.else):void 0!==t.else&&t.else&&"Token"===t.else._class?t.else=n.Z.fromJson(t.else):void 0!==t.else&&t.else&&"Choice"===t.else._class&&(t.else=o.Z.fromJson(t.else)));const{cond:s,then:_}=t;this.cond=s,this.then=_,this.else=t.else}static fromJson(t){return new r({},t)}get type(){return this._class}set type(t){this._class=t}}const _=r},861:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(721);class n{_class="Scene";get type(){return this._class}set type(t){this._class=t}constructor(t,{first:e,name:s},n){if(n&&("string"==typeof n&&(n=JSON.parse(n)),t=n.sections,e=n.first,s=n.name),!(t instanceof Array))throw new i.Z("Unexpected argument supplied."+t+"is not an array.");this.sections=t,this.first=e||t[0],this.last=t?t[t.length-1]:null,this.name=s||"Untitled"}static fromJson(t){return new n([],{},t)}}const o=n},167:(t,e,s)=>{"use strict";s.d(e,{Z:()=>c});var i=s(858),n=s(608),o=s(72),r=s(546),_=s(470);class a{_class="Section";constructor(t,e,s,a,c){c?("string"==typeof c&&(c=JSON.parse(c)),Object.assign(this,c),this.choices=this.choices.map((t=>i.Z.fromJson(t))),this.text=(this.text||[]).map((t=>"Token"===t._class?n.Z.fromJson(t):"ConditionalBlock"===t._class?o.Z.fromJson(t):"Action"===t._class?r.Z.fromJson(t):"Choice"===t._class?i.Z.fromJson(t):void 0)),this.settings=_.Z.fromJson(this.settings)):(this.text="string"==typeof t?t.trim():t,this.title=a.title,this.choices=e,this.serial=s,this.settings=a,this.identifier=a.identifier)}static fromJson(t){return new a({},{},{},{},t)}findChoice(t){let e,s=parseInt(t);return t&&(t=s),"number"==typeof t?e=this.choices.findIndex((e=>e.choiceI===t)):"string"==typeof t&&(e=this.choices.findIndex((e=>e.identifier?.toLowerCase()===t?.toLowerCase()))),-1===e&&(e=0),this.choices[e]}get type(){return this._class}set type(t){this._class=t}}const c=a},470:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(13);class n extends i.Z{_class="SectionSettings";get type(){return this._class}set type(t){this._class=t}constructor(t,e){e&&("string"==typeof e&&(e=JSON.parse(e)),t=e),super(t),this.timer=t.timer,this.title=t.title,this.variables={}}static fromJson(t){return new n({},t)}}const o=n},13:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});class i{_class="Settings";get type(){return this._class}set type(t){this._class=t}constructor(t,e){e?("string"==typeof e&&(e=JSON.parse(e)),this.input=e.input):this.input=t}static fromJson(t){return new i({},t)}}const n=i},207:(t,e,s)=>{"use strict";s.d(e,{Z:()=>_});var i=s(167),n=s(861),o=s(146);class r{_class="Story";get type(){return this._class}set type(t){this._class=t}constructor(t,{sections:e,passages:s,scenes:r},_,{globals:a,stats:c},l){l?("string"==typeof l&&(l=JSON.parse(l)),Object.assign(this,l),this.sections=this.sections.map((t=>i.Z.fromJson(t))),this.scenes=this.scenes.map((t=>n.Z.fromJson(t))),this.settings=o.Z.fromJson(this.settings)):(this.name=t.trim(),this.sections=e||[],this.passages=s||[],this.scenes=r||[],this.settings=_,this.variables={},a&&Object.keys(a).forEach((t=>{this.variables[t]=a[t]})),this.persistent=this.variables,this.stats=c)}static fromJson(t){return new r({},{},{},{},t)}findSection(t){let e;return"number"==typeof t?e=this.sections.findIndex((e=>e.serial===t)):"string"==typeof t&&(e=this.sections.findIndex((e=>e.identifier?.toLowerCase()===t?.toLowerCase()))),-1===e&&(console.warn("No section "+t+" found. Reverting to default section serial 1."),e=0),this.sections[e]}findScene(t){let e;return"number"==typeof t?e=this.scenes.findIndex((e=>e.serial===t)):"string"==typeof t&&(e=this.scenes.findIndex((e=>e.identifier?.toLowerCase()===t?.toLowerCase()))),-1===e&&(console.warn("No scene "+t+" found. Reverting to default scene serial 1."),e=0),this.scenes[e]}findPassage(t){let e=this.passages.findIndex((e=>e.serial===t));return-1===e&&(console.warn("No passage "+t+" found. Reverting to default passage serial 1."),e=0),this.passages[e]}}const _=r},146:(t,e,s)=>{"use strict";s.d(e,{Z:()=>o});var i=s(13);class n extends i.Z{_class="StorySettings";get type(){return this._class}set type(t){this._class=t}constructor(t,e){e&&("string"==typeof e&&(e=JSON.parse(e)),t=e),super(t);const{referrable:s,name:i}=this.input;this.startAt=this.input.startAt||0,this.fullTimer=this.input.fullTimer||null,this.referrable=s||!1,this.name=i}static fromJson(t){return new n({},t)}}const o=n},608:(t,e,s)=>{"use strict";s.d(e,{Z:()=>n});class i{_class="Token";constructor(t,e){e&&("string"==typeof e&&(e=JSON.parse(e)),t=e);const{type:s,symbol:i,id:n,line:o,col:r}=t;this.type=t.type,this.symbol=t.symbol,this.id=t.id,this.line=t.line,this.col=t.col}static fromJson(t){return new i(null,t)}}const n=i}}]);